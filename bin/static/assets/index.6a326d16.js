const ve=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerpolicy&&(o.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?o.credentials="include":l.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(l){if(l.ep)return;l.ep=!0;const o=n(l);fetch(l.href,o)}};ve();function w(){}function we(t){return t&&typeof t=="object"&&typeof t.then=="function"}function pe(t){return t()}function se(){return Object.create(null)}function J(t){t.forEach(pe)}function $e(t){return typeof t=="function"}function ee(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Se(t){return Object.keys(t).length===0}function d(t,e){t.appendChild(e)}function L(t,e,n){t.insertBefore(e,n||null)}function E(t){t.parentNode.removeChild(t)}function ce(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function p(t){return document.createElement(t)}function N(t){return document.createTextNode(t)}function q(){return N(" ")}function ge(){return N("")}function A(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function k(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function je(t){return Array.from(t.childNodes)}function R(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function G(t,e){t.value=e==null?"":e}function ye(t,e,n,r){n===null?t.style.removeProperty(e):t.style.setProperty(e,n,r?"important":"")}function Q(t,e,n){t.classList[n?"add":"remove"](e)}let W;function O(t){W=t}function be(){if(!W)throw new Error("Function called outside component initialization");return W}function Oe(t){be().$$.on_mount.push(t)}const F=[],ie=[],K=[],ue=[],Ne=Promise.resolve();let Z=!1;function Ee(){Z||(Z=!0,Ne.then(te))}function x(t){K.push(t)}const Y=new Set;let H=0;function te(){const t=W;do{for(;H<F.length;){const e=F[H];H++,O(e),Ce(e.$$)}for(O(null),F.length=0,H=0;ie.length;)ie.pop()();for(let e=0;e<K.length;e+=1){const n=K[e];Y.has(n)||(Y.add(n),n())}K.length=0}while(F.length);for(;ue.length;)ue.pop()();Z=!1,Y.clear(),O(t)}function Ce(t){if(t.fragment!==null){t.update(),J(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(x)}}const D=new Set;let I;function Le(){I={r:0,c:[],p:I}}function Pe(){I.r||J(I.c),I=I.p}function z(t,e){t&&t.i&&(D.delete(t),t.i(e))}function X(t,e,n,r){if(t&&t.o){if(D.has(t))return;D.add(t),I.c.push(()=>{D.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}else r&&r()}function qe(t,e){const n=e.token={};function r(l,o,i,a){if(e.token!==n)return;e.resolved=a;let c=e.ctx;i!==void 0&&(c=c.slice(),c[i]=a);const s=l&&(e.current=l)(c);let h=!1;e.block&&(e.blocks?e.blocks.forEach((m,g)=>{g!==o&&m&&(Le(),X(m,1,1,()=>{e.blocks[g]===m&&(e.blocks[g]=null)}),Pe())}):e.block.d(1),s.c(),z(s,1),s.m(e.mount(),e.anchor),h=!0),e.block=s,e.blocks&&(e.blocks[o]=s),h&&te()}if(we(t)){const l=be();if(t.then(o=>{O(l),r(e.then,1,e.value,o),O(null)},o=>{if(O(l),r(e.catch,2,e.error,o),O(null),!e.hasCatch)throw o}),e.current!==e.pending)return r(e.pending,0),!0}else{if(e.current!==e.then)return r(e.then,1,e.value,t),!0;e.resolved=t}}function Ae(t,e,n){const r=e.slice(),{resolved:l}=t;t.current===t.then&&(r[t.value]=l),t.current===t.catch&&(r[t.error]=l),t.block.p(r,n)}function ke(t){t&&t.c()}function ne(t,e,n,r){const{fragment:l,on_mount:o,on_destroy:i,after_update:a}=t.$$;l&&l.m(e,n),r||x(()=>{const c=o.map(pe).filter($e);i?i.push(...c):J(c),t.$$.on_mount=[]}),a.forEach(x)}function re(t,e){const n=t.$$;n.fragment!==null&&(J(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ie(t,e){t.$$.dirty[0]===-1&&(F.push(t),Ee(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function le(t,e,n,r,l,o,i,a=[-1]){const c=W;O(t);const s=t.$$={fragment:null,ctx:null,props:o,update:w,not_equal:l,bound:se(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:se(),dirty:a,skip_bound:!1,root:e.target||c.$$.root};i&&i(s.root);let h=!1;if(s.ctx=n?n(t,e.props||{},(m,g,...P)=>{const v=P.length?P[0]:g;return s.ctx&&l(s.ctx[m],s.ctx[m]=v)&&(!s.skip_bound&&s.bound[m]&&s.bound[m](v),h&&Ie(t,m)),g}):[],s.update(),h=!0,J(s.before_update),s.fragment=r?r(s.ctx):!1,e.target){if(e.hydrate){const m=je(e.target);s.fragment&&s.fragment.l(m),m.forEach(E)}else s.fragment&&s.fragment.c();e.intro&&z(t.$$.fragment),ne(t,e.target,e.anchor,e.customElement),te()}O(c)}class oe{$destroy(){re(this,1),this.$destroy=w}$on(e,n){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const l=r.indexOf(n);l!==-1&&r.splice(l,1)}}$set(e){this.$$set&&!Se(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const V=()=>location.origin,Je=()=>{const t=new URL("/messages",location.href);return t.port="8080",t.protocol="ws:",t.href};function ae(t,e,n){const r=t.slice();return r[13]=e[n],r}function fe(t,e,n){const r=t.slice();return r[16]=e[n],r}function de(t){let e,n=t[16].name+"",r,l,o,i;function a(){return t[9](t[16])}return{c(){e=p("li"),r=N(n),l=q(),ye(e,"cursor","pointer"),Q(e,"w3-blue",t[3]===t[16].name)},m(c,s){L(c,e,s),d(e,r),d(e,l),o||(i=A(e,"click",a),o=!0)},p(c,s){t=c,s&2&&n!==(n=t[16].name+"")&&R(r,n),s&10&&Q(e,"w3-blue",t[3]===t[16].name)},d(c){c&&E(e),o=!1,i()}}}function he(t){let e,n=t[16].name!==t[0].name&&de(t);return{c(){n&&n.c(),e=ge()},m(r,l){n&&n.m(r,l),L(r,e,l)},p(r,l){r[16].name!==r[0].name?n?n.p(r,l):(n=de(r),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(r){n&&n.d(r),r&&E(e)}}}function me(t){let e,n=t[13].from+"",r,l,o=t[13].body+"",i;return{c(){e=p("li"),r=N(n),l=N(": "),i=N(o)},m(a,c){L(a,e,c),d(e,r),d(e,l),d(e,i)},p(a,c){c&25&&n!==(n=a[13].from+"")&&R(r,n),c&25&&o!==(o=a[13].body+"")&&R(i,o)},d(a){a&&E(e)}}}function Te(t){let e,n,r,l,o=t[0].name+"",i,a,c,s,h,m,g,P,v,$,_,C,S,M,T=t[1],y=[];for(let u=0;u<T.length;u+=1)y[u]=he(fe(t,T,u));let U=t[4].filter(t[10]),b=[];for(let u=0;u<U.length;u+=1)b[u]=me(ae(t,U,u));return{c(){e=p("div"),n=p("div"),r=p("ul"),l=p("li"),i=N(o),a=N(" (you)"),c=q();for(let u=0;u<y.length;u+=1)y[u].c();s=q(),h=p("div"),m=p("div"),g=p("ul");for(let u=0;u<b.length;u+=1)b[u].c();P=q(),v=p("div"),$=p("input"),_=q(),C=p("button"),C.textContent="send",ye(l,"cursor","pointer"),Q(l,"w3-blue",t[3]===t[0].name),k(r,"class","w3-ul"),k(n,"class","users w3-container svelte-1hysq6v"),k(g,"class","messages-ul svelte-1hysq6v"),k(m,"class","messages-inner"),k($,"class","message-sender-input svelte-1hysq6v"),k(C,"class","send-message-btn svelte-1hysq6v"),k(v,"class","sender-container svelte-1hysq6v"),k(h,"class","messages svelte-1hysq6v"),k(e,"class","container svelte-1hysq6v")},m(u,j){L(u,e,j),d(e,n),d(n,r),d(r,l),d(l,i),d(l,a),d(r,c);for(let f=0;f<y.length;f+=1)y[f].m(r,null);d(e,s),d(e,h),d(h,m),d(m,g);for(let f=0;f<b.length;f+=1)b[f].m(g,null);d(h,P),d(h,v),d(v,$),G($,t[2]),d(v,_),d(v,C),S||(M=[A(l,"click",t[8]),A($,"input",t[11]),A($,"keypress",t[6]),A(C,"click",t[12])],S=!0)},p(u,[j]){if(j&1&&o!==(o=u[0].name+"")&&R(i,o),j&9&&Q(l,"w3-blue",u[3]===u[0].name),j&43){T=u[1];let f;for(f=0;f<T.length;f+=1){const B=fe(u,T,f);y[f]?y[f].p(B,j):(y[f]=he(B),y[f].c(),y[f].m(r,null))}for(;f<y.length;f+=1)y[f].d(1);y.length=T.length}if(j&25){U=u[4].filter(u[10]);let f;for(f=0;f<U.length;f+=1){const B=ae(u,U,f);b[f]?b[f].p(B,j):(b[f]=me(B),b[f].c(),b[f].m(g,null))}for(;f<b.length;f+=1)b[f].d(1);b.length=U.length}j&4&&$.value!==u[2]&&G($,u[2])},i:w,o:w,d(u){u&&E(e),ce(y,u),ce(b,u),S=!1,J(M)}}}function Ue(t,e,n){let{client:r}=e,{token:l}=e,o=[],i="",a=r.name,c=[];Oe(()=>{var C;const _=new WebSocket(`${Je()}/${l}`);_.onmessage=({data:S})=>{let M=JSON.parse(S);c.push({from:M.from,to:r.name,body:M.body}),sessionStorage.setItem("chat_history",JSON.stringify(c)),n(4,c)},fetch(`${V()}/clients`).then(S=>S.json()).then(S=>n(1,o=S)),n(4,c=JSON.parse((C=sessionStorage.getItem("chat_history"))!=null?C:"[]"))});const s=_=>{n(3,a=_)},h=async _=>{_&&_.key!=="Enter"||!i.length||await fetch(`${V()}/send_message`,{body:JSON.stringify({token:l,body:i,to:a}),method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(()=>{c.push({from:r.name,to:a,body:i}),sessionStorage.setItem("chat_history",JSON.stringify(c)),n(4,c),n(2,i="")})},m=()=>s(r.name),g=_=>s(_.name),P=_=>_.from===r.name&&_.to===a||_.from===a&&_.to===r.name;function v(){i=this.value,n(2,i)}const $=()=>h();return t.$$set=_=>{"client"in _&&n(0,r=_.client),"token"in _&&n(7,l=_.token)},[r,o,i,a,c,s,h,l,m,g,P,v,$]}class Me extends oe{constructor(e){super(),le(this,e,Ue,Te,ee,{client:0,token:7})}}function _e(t){let e,n;return{c(){e=p("h1"),n=N(t[1])},m(r,l){L(r,e,l),d(e,n)},p(r,l){l&2&&R(n,r[1])},d(r){r&&E(e)}}}function Be(t){let e,n,r,l,o,i,a,c,s=t[1]&&_e(t);return{c(){e=p("div"),s&&s.c(),n=q(),r=p("div"),l=p("input"),o=q(),i=p("button"),i.textContent="login",k(l,"type","text"),k(l,"placeholder","enter username"),k(e,"class","container svelte-jrrmmt")},m(h,m){L(h,e,m),s&&s.m(e,null),d(e,n),d(e,r),d(r,l),G(l,t[0]),d(r,o),d(r,i),a||(c=[A(l,"input",t[3]),A(i,"click",t[2])],a=!0)},p(h,[m]){h[1]?s?s.p(h,m):(s=_e(h),s.c(),s.m(e,n)):s&&(s.d(1),s=null),m&1&&l.value!==h[0]&&G(l,h[0])},i:w,o:w,d(h){h&&E(e),s&&s.d(),a=!1,J(c)}}}function Fe(t,e,n){let r="",l="";const o=async()=>{try{n(1,l="");let a=await fetch(`${V()}/register`,{body:JSON.stringify({name:r}),method:"POST",headers:{"content-type":"application/json",accept:"application/json"}}).then(c=>c.status===200?c.json():Promise.reject());sessionStorage.setItem("token",a.token),window.location.reload()}catch(a){console.log(a),n(1,l="username is taken")}};function i(){r=this.value,n(0,r)}return[r,l,o,i]}class Re extends oe{constructor(e){super(),le(this,e,Fe,Be,ee,{})}}function We(t){let e,n;return e=new Re({}),{c(){ke(e.$$.fragment)},m(r,l){ne(e,r,l),n=!0},p:w,i(r){n||(z(e.$$.fragment,r),n=!0)},o(r){X(e.$$.fragment,r),n=!1},d(r){re(e,r)}}}function ze(t){let e,n;return e=new Me({props:{client:t[2],token:t[0]}}),{c(){ke(e.$$.fragment)},m(r,l){ne(e,r,l),n=!0},p:w,i(r){n||(z(e.$$.fragment,r),n=!0)},o(r){X(e.$$.fragment,r),n=!1},d(r){re(e,r)}}}function He(t){let e;return{c(){e=p("h1"),e.textContent="Loading..."},m(n,r){L(n,e,r)},p:w,i:w,o:w,d(n){n&&E(e)}}}function Ke(t){let e,n,r={ctx:t,current:null,token:null,hasCatch:!0,pending:He,then:ze,catch:We,value:2,blocks:[,,,]};return qe(t[1],r),{c(){e=ge(),r.block.c()},m(l,o){L(l,e,o),r.block.m(l,r.anchor=o),r.mount=()=>e.parentNode,r.anchor=e,n=!0},p(l,[o]){t=l,Ae(r,t,o)},i(l){n||(z(r.block),n=!0)},o(l){for(let o=0;o<3;o+=1){const i=r.blocks[o];X(i)}n=!1},d(l){l&&E(e),r.block.d(l),r.token=null,r=null}}}function De(t){let e=sessionStorage.getItem("token"),n=e?fetch(`${V()}/status/${e}`).then(r=>r.json()):Promise.reject();return[e,n]}class Ge extends oe{constructor(e){super(),le(this,e,De,Ke,ee,{})}}new Ge({target:document.getElementById("app")});
